<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¹ãƒ—ãƒªãƒ³ã‚¿ãƒ¼</title>
  <style>
    :root{--bg:#0b1020;--panel:#121a33;--text:#eaf0ff;--muted:#9fb0d0;--line:rgba(255,255,255,.10);--radius:18px}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,"Hiragino Kaku Gothic ProN","Meiryo",sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:18px 16px 44px}
    .card{border:1px solid var(--line);background:rgba(18,26,51,.92);border-radius:var(--radius);padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .btn{border:1px solid var(--line);background:rgba(255,255,255,.06);color:var(--text);border-radius:12px;padding:10px 12px;cursor:pointer}
    .btn:hover{background:rgba(255,255,255,.08)}
    .muted{color:var(--muted)}
    .target{margin-top:10px;border:1px solid var(--line);background:rgba(255,255,255,.04);border-radius:14px;padding:12px;line-height:1.7;font-family:ui-monospace,Menlo,Consolas,monospace}
    .target .ok{opacity:.45;text-decoration:line-through}
    .target .cur{background:rgba(255,255,255,.12);border-radius:6px;padding:0 2px}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:rgba(0,0,0,.25);color:var(--text);outline:none;font-size:16px}
    .stats{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .box{flex:1 1 160px;border:1px solid var(--line);background:rgba(255,255,255,.04);border-radius:14px;padding:10px 12px}
    .k{font-size:12px;color:var(--muted)} .v{margin-top:4px;font-weight:800}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <div>
          <div style="font-weight:900;font-size:18px">ğŸƒ ç›®æŒ‡ã›ï¼ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¹ãƒ—ãƒªãƒ³ã‚¿ãƒ¼</div>
          <div class="muted" style="margin-top:6px;font-size:13px">å›ºå®šæ–‡ã‚’æœ€å¾Œã¾ã§æ‰“ã¡åˆ‡ã‚‹ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯</div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <a class="btn" href="index.html">â† åºƒå ´ã¸</a>
          <button class="btn" id="btnStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button class="btn" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
      </div>

      <div class="stats">
        <div class="box"><div class="k">Time</div><div class="v" id="uiTime">-</div></div>
        <div class="box"><div class="k">WPM</div><div class="v" id="uiWpm">-</div></div>
        <div class="box"><div class="k">Accuracy</div><div class="v" id="uiAcc">-</div></div>
        <div class="box"><div class="k">Best (local)</div><div class="v" id="uiBest">-</div></div>
      </div>

      <div class="target" id="target"></div>

      <div style="margin-top:10px">
        <input id="input" placeholder="ã“ã“ã«å…¥åŠ›ï¼ˆStartã§æœ‰åŠ¹åŒ–ï¼‰" disabled />
        <div class="muted" style="margin-top:6px;font-size:12px">â€»ãƒŸã‚¹ã—ã¦ã‚‚ç¶šè¡Œã€‚æ­£ç¢ºæ€§ã‚‚è©•ä¾¡ã«åæ˜ ã€‚</div>
      </div>

      <div class="muted" id="uiSave" style="margin-top:10px;font-size:12px">ä¿å­˜ï¼šæœª</div>
    </div>
  </div>

  <script>
    // ---- Local Stats ----
    const LS_STATS="typing_plaza_stats_v1";
    function safeParse(v,f){try{return JSON.parse(v)??f}catch{return f}}
    const defaultStats={
      sprinter:{bestWpm:null,bestAcc:null},
      global:{bestWpm:null,bestAcc:null}
    };
    function loadStats(){
      const s=safeParse(localStorage.getItem(LS_STATS),defaultStats);
      return { ...defaultStats, ...s, sprinter:{...defaultStats.sprinter,...(s.sprinter||{})}, global:{...defaultStats.global,...(s.global||{})} };
    }
    function saveStats(s){localStorage.setItem(LS_STATS,JSON.stringify(s));}
    function fmtWpm(v){return v==null?"-":`${Math.round(v)} WPM`}
    function fmtAcc(v){return v==null?"-":`${Math.max(0,Math.min(100,v)).toFixed(1)}%`}

    // ---- Game Core ----
    const TEXT="the quick brown fox jumps over the lazy dog. typing is a skill. keep calm and type faster.";
    const elTarget=document.getElementById("target");
    const elInput=document.getElementById("input");
    const uiTime=document.getElementById("uiTime");
    const uiWpm=document.getElementById("uiWpm");
    const uiAcc=document.getElementById("uiAcc");
    const uiBest=document.getElementById("uiBest");
    const uiSave=document.getElementById("uiSave");

    let started=false, startAt=0, timer=null;
    let correct=0, total=0, idx=0;

    function renderTarget(){
      const done=TEXT.slice(0,idx);
      const cur=TEXT.slice(idx,idx+1);
      const rest=TEXT.slice(idx+1);
      elTarget.innerHTML =
        `<span class="ok">${escapeHtml(done)}</span>` +
        `<span class="cur">${escapeHtml(cur||" ")}</span>` +
        `<span>${escapeHtml(rest)}</span>`;
    }
    function escapeHtml(s){return s.replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}

    function reset(){
      started=false; clearInterval(timer); timer=null;
      startAt=0; correct=0; total=0; idx=0;
      elInput.value=""; elInput.disabled=true;
      uiTime.textContent="-"; uiWpm.textContent="-"; uiAcc.textContent="-";
      uiSave.textContent="ä¿å­˜ï¼šæœª";
      renderTarget();
      renderBest();
    }

    function renderBest(){
      const s=loadStats();
      uiBest.textContent = `${fmtWpm(s.sprinter.bestWpm)} / ${fmtAcc(s.sprinter.bestAcc)}`;
    }

    function start(){
      reset();
      started=true;
      elInput.disabled=false;
      elInput.focus();
      startAt=performance.now();
      timer=setInterval(tick,100);
    }

    function tick(){
      if(!started) return;
      const sec=(performance.now()-startAt)/1000;
      uiTime.textContent = `${sec.toFixed(1)}s`;
      const minutes = sec/60;
      const wpm = minutes>0 ? (correct/5)/minutes : 0;
      const acc = total>0 ? (correct/total)*100 : 100;
      uiWpm.textContent = `${Math.round(wpm)} WPM`;
      uiAcc.textContent = `${acc.toFixed(1)}%`;
    }

    function finish(){
      started=false; clearInterval(timer); timer=null;
      tick();
      const sec=(performance.now()-startAt)/1000;
      const minutes = sec/60;
      const wpm = minutes>0 ? (correct/5)/minutes : 0;
      const acc = total>0 ? (correct/total)*100 : 100;

      // save local best
      const s=loadStats();
      if(s.sprinter.bestWpm==null || wpm>s.sprinter.bestWpm){
        s.sprinter.bestWpm=wpm;
      }
      if(s.sprinter.bestAcc==null || acc>s.sprinter.bestA
