<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- åŸºæœ¬ãƒ¡ã‚¿ -->
    <meta name="description" content="ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§PDFã‚’ä½œæˆã§ãã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¨ãƒ‡ã‚£ã‚¿ã€‚è¦‹å‡ºã—ãƒ»ç”»åƒãƒ»ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šã«å¯¾å¿œã€‚">
    <meta name="author" content="Koppy Lab">
    <meta name="robots" content="index,follow">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="theme-color" content="#0f172a">
    <meta name="color-scheme" content="dark light">
    <link rel="canonical" href="https://YOUR_DOMAIN/easy-pdf-maker">

    <!-- OGPï¼ˆSNSã‚«ãƒ¼ãƒ‰ï¼‰ -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼">
    <meta property="og:title" content="æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼ â€” ãƒ–ãƒ©ã‚¦ã‚¶ã§PDFä½œæˆ">
    <meta property="og:description" content="ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§PDFã‚’ä½œæˆã€‚è¦‹å‡ºã—ãƒ»ç”»åƒãƒ»ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šã«å¯¾å¿œã€‚">
    <meta property="og:url" content="https://YOUR_DOMAIN/easy-pdf-maker">
    <meta property="og:image" content="https://YOUR_DOMAIN/ogp.png">
    <meta property="og:locale" content="ja_JP">

    <!-- Twitterã‚«ãƒ¼ãƒ‰ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼ â€” ãƒ–ãƒ©ã‚¦ã‚¶ã§PDFä½œæˆ">
    <meta name="twitter:description" content="ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§PDFã‚’ä½œæˆã€‚è¦‹å‡ºã—ãƒ»ç”»åƒãƒ»ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šã«å¯¾å¿œã€‚">
    <meta name="twitter:image" content="https://YOUR_DOMAIN/ogp.png">

    <!-- ã‚¢ã‚¤ã‚³ãƒ³é¡ -->
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">

    <!-- PWAï¼ˆä»»æ„ï¼‰ -->
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">

  <title>æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ui-bg:#0f172a; /* slate-900 */
      --ui-surface:#111827; /* gray-900 */
      --ui-border:#374151; /* gray-700 */
      --ui-text:#e5e7eb; /* gray-200 */
      --ui-muted:#9ca3af; /* gray-400 */
      --accent:#22d3ee; /* cyan-400 */
      --accent-2:#a78bfa; /* violet-400 */
      --paper-shadow:0 10px 30px rgba(0,0,0,.35);
      --paper-bg:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN","Yu Gothic", Meiryo, sans-serif;
      background:linear-gradient(180deg, var(--ui-bg), #0b1224 60%);
      color:var(--ui-text);
    }
    .app{
      display:flex; flex-direction:column; min-height:100dvh;
    }
    header{
      border-bottom:1px solid var(--ui-border);
      background:radial-gradient(1200px 300px at 10% -20%, rgba(34,211,238,.12), transparent 60%),
                 radial-gradient(1200px 300px at 90% -20%, rgba(167,139,250,.12), transparent 60%),
                 var(--ui-surface);
      padding:14px 16px;
      display:flex; align-items:center; gap:14px; flex-wrap:wrap;
      position:sticky; top:0; z-index:50;
    }
    header h1{font-size:16px; font-weight:700; margin:0 8px 0 0; letter-spacing:.02em}
    .sep{width:1px; height:28px; background:var(--ui-border)}
    .ctrl-row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    label{font-size:12px; color:var(--ui-muted)}
    select,input[type="number"],input[type="text"]{
      background:#0b1224; border:1px solid var(--ui-border); color:var(--ui-text);
      border-radius:10px; padding:8px 10px; font-size:13px; outline:none; min-width:80px;
    }
    input[type="checkbox"]{transform:translateY(1px)}
    button{
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      color:#0b1224; border:0; padding:9px 14px; border-radius:12px; font-weight:700; cursor:pointer; font-size:13px;
      transition:filter .15s ease; box-shadow:0 6px 16px rgba(34,211,238,.15), 0 6px 16px rgba(167,139,250,.12);
    }
    button.secondary{background:#0b1224; color:var(--ui-text); border:1px solid var(--ui-border); box-shadow:none}
    button:hover{filter:brightness(1.05)}

    .toolbar{
      display:flex; gap:8px; padding:10px 16px; background:#0b1224; border-bottom:1px solid var(--ui-border);
      position:sticky; top:64px; z-index:40; flex-wrap:wrap
    }
    .tbtn{background:#0e162d; border:1px solid var(--ui-border); color:var(--ui-text); padding:8px 10px; border-radius:10px; cursor:pointer; font-size:13px}
    .tbtn:hover{background:#121a33}

    main{
      flex:1; display:flex; justify-content:center; padding:24px; gap:24px; align-items:flex-start;
    }
    .side{
      width:340px; background:#0b1224; border:1px solid var(--ui-border); border-radius:16px; padding:16px; position:sticky; top:116px; height:max-content
    }
    .side h3{margin:0 0 10px; font-size:14px}
    .side .group{border-top:1px solid var(--ui-border); padding-top:12px; margin-top:12px}

    .stage{
      flex:1; display:flex; justify-content:center; align-items:flex-start; flex-wrap:wrap; gap:24px
    }

    .paper{
      background:var(--paper-bg); color:#111; width:min(100%, 900px); border-radius:16px; box-shadow:var(--paper-shadow);
      padding:0; overflow:hidden; border:1px solid rgba(0,0,0,.05);
    }
    .paper-inner{ padding:24px; }

    .print-body{ max-width:680px; margin:0 auto; background:white; color:#111; padding:24px; border-radius:12px }
    .print-body img{ max-width:100%; height:auto }
    #editor{ min-height:1200px; outline:none }

    .helper{font-size:12px; color:var(--ui-muted)}

    .print-header,.print-footer{ display:none; }
    .page-break{ display:inline-block; padding:6px 10px; margin:12px 0; background:#f5f5f5; color:#444; border:1px dashed #bbb; border-radius:8px }

    /* Print styles injected dynamically */
    @media print{
      body{ background:white; }
      header, .toolbar, .side{ display:none !important; }
      .paper{ box-shadow:none; border:none }
      .print-header,.print-footer{ display:block; position:fixed; left:0; right:0; color:#111; font-size:12px; padding:6mm 12mm; }
      .print-header{ top:0; border-bottom:1px solid #ddd; }
      .print-footer{ bottom:0; border-top:1px solid #ddd; }
      .print-body{ margin:0 auto; background:white; color:#111; }
      .page-break{ break-after:page; page-break-after:always; color:#888; border:none; height:0; padding:0; margin:0 }
      .page-number::after{ content: counter(page); }
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>ğŸ“ æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
    <div class="sep"></div>
    <div class="ctrl-row">
      <label>ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º
        <select id="pageSize">
          <option value="A4">A4</option>
          <option value="A5">A5</option>
          <option value="Letter">Letter</option>
        </select>
      </label>
      <label>å‘ã
        <select id="orientation">
          <option value="portrait">ç¸¦</option>
          <option value="landscape">æ¨ª</option>
        </select>
      </label>
      <label>ä½™ç™½ (mm)
        <input type="number" id="margin" min="5" max="40" step="1" value="15" />
      </label>
      <label>ãƒ•ã‚©ãƒ³ãƒˆ
        <select id="font">
          <option value="'Noto Sans JP', sans-serif">Noto Sans JP</option>
          <option value="system-ui, -apple-system, Segoe UI, Roboto, 'Yu Gothic', Meiryo, sans-serif">ã‚·ã‚¹ãƒ†ãƒ (ã‚´ã‚·ãƒƒã‚¯)</option>
          <option value="serif">æ˜æœ (serif)</option>
          <option value="monospace">ç­‰å¹… (monospace)</option>
        </select>
      </label>
      <label>æ–‡å­—ã‚µã‚¤ã‚º
        <input type="number" id="fontSize" min="10" max="24" step="1" value="16" />
      </label>
      <label>è¡Œé–“
        <input type="number" id="lineHeight" min="1" max="2.4" step="0.1" value="1.6" />
      </label>
      <button id="save" class="secondary" title="ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜">ä¿å­˜</button>
      <button id="load" class="secondary" title="ä¿å­˜å†…å®¹ã‚’èª­ã¿è¾¼ã¿">èª­ã¿è¾¼ã¿</button>
      <button id="reset" class="secondary" title="åˆæœŸåŒ–">åˆæœŸåŒ–</button>
      <button id="printBtn" title="PDFã‚’ä½œæˆ (å°åˆ·ã§PDFä¿å­˜)">PDFã‚’ä½œæˆ</button>
    </div>
  </header>

  <div class="toolbar" aria-label="ç·¨é›†ãƒ„ãƒ¼ãƒ«ãƒãƒ¼">
    <button class="tbtn" data-cmd="bold"><b>B</b></button>
    <button class="tbtn" data-cmd="italic"><i>I</i></button>
    <button class="tbtn" data-cmd="underline"><u>U</u></button>
    <span class="sep" style="height:24px"></span>
    <button class="tbtn" data-block="H1">H1</button>
    <button class="tbtn" data-block="H2">H2</button>
    <button class="tbtn" data-block="P">æ®µè½</button>
    <button class="tbtn" data-cmd="insertUnorderedList">ç®‡æ¡æ›¸ã</button>
    <button class="tbtn" data-cmd="insertOrderedList">ç•ªå·</button>
    <span class="sep" style="height:24px"></span>
    <button class="tbtn" data-cmd="justifyLeft">å·¦</button>
    <button class="tbtn" data-cmd="justifyCenter">ä¸­å¤®</button>
    <button class="tbtn" data-cmd="justifyRight">å³</button>
    <span class="sep" style="height:24px"></span>
    <button class="tbtn" id="linkBtn">ãƒªãƒ³ã‚¯</button>
    <button class="tbtn" id="imgBtn">ç”»åƒ</button>
    <button class="tbtn" id="pageBreakBtn">ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Š</button>
    <input type="file" id="imgInput" accept="image/*" hidden />
  </div>

  <main>
    <aside class="side" id="side">
      <h3>ãƒ˜ãƒƒãƒ€ãƒ¼ & ãƒ•ãƒƒã‚¿ãƒ¼</h3>
      <div class="group">
        <label><input type="checkbox" id="useHeader" checked> ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¡¨ç¤º</label>
        <input type="text" id="headerText" placeholder="ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆ" value="æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼" />
        <div class="helper">ãƒ˜ãƒƒãƒ€ãƒ¼ã¯å„ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã«å›ºå®šè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
      </div>
      <div class="group">
        <label><input type="checkbox" id="useFooter" checked> ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¡¨ç¤º</label>
        <input type="text" id="footerText" placeholder="ãƒ•ãƒƒã‚¿ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆ" value="Â© 2025 Koppy Lab" />
        <label style="display:flex; gap:8px; align-items:center; margin-top:8px">
          <input type="checkbox" id="usePageNum" checked> ãƒšãƒ¼ã‚¸ç•ªå·ã‚’å³ä¸‹ã«è¡¨ç¤º
        </label>
        <div class="helper">Chrome/Edge ã®å°åˆ·ã§æœ‰åŠ¹ã§ã™ã€‚åˆè¨ˆãƒšãƒ¼ã‚¸æ•°ã¯ç’°å¢ƒã«ã‚ˆã£ã¦è¡¨ç¤ºã•ã‚Œãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</div>
      </div>
      <div class="group">
        <h3>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
        <div class="ctrl-row" style="gap:6px; flex-wrap:wrap">
          <button class="secondary" data-tpl="simple">ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸</button>
          <button class="secondary" data-tpl="flyer">ã‚¤ãƒ™ãƒ³ãƒˆå‘ŠçŸ¥</button>
          <button class="secondary" data-tpl="invoice">ç°¡æ˜“è«‹æ±‚æ›¸</button>
        </div>
        <div class="helper">ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç¾åœ¨ã®å†…å®¹ã®æœ«å°¾ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæŒ¿å…¥ã•ã‚Œã¾ã™ã€‚</div>
      </div>
      <div class="group">
        <h3>ãƒ’ãƒ³ãƒˆ</h3>
        <ul class="helper" style="padding-left:18px; line-height:1.7">
          <li>ç”»åƒã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€è²¼ã‚Šä»˜ã‘ã§ã‚‚æŒ¿å…¥ã§ãã¾ã™ã€‚</li>
          <li>ã€ŒPDFã‚’ä½œæˆã€ã‚’æŠ¼ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®å°åˆ·ç”»é¢ã§ <b>PDFã«ä¿å­˜</b> ã‚’é¸æŠã€‚</li>
          <li>ã€Œãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šã€ã§ä»»æ„ã®ä½ç½®ã‹ã‚‰æ–°ã—ã„ãƒšãƒ¼ã‚¸ã«ã€‚</li>
        </ul>
      </div>
    </aside>

    <section class="stage">
      <div class="paper">
        <div class="paper-inner">
          <div class="print-header" id="printHeader"><span id="headerContent"></span></div>
          <div class="print-footer" id="printFooter"><span id="footerContent"></span> <span class="page-number" id="pageNum" style="float:right"></span></div>

          <div class="print-body" id="printBody" style="">
            <div id="editor" contenteditable="true" spellcheck="false">
              <h1>ã‚ˆã†ã“ãï¼ æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼</h1>
              <p>ã“ã“ã«æ–‡ç« ã‚’æ›¸ãã€ç”»åƒã‚’å…¥ã‚Œã€è¦‹å‡ºã—ã‚„ç®‡æ¡æ›¸ãã§æ•´ãˆãŸã‚‰ã€å³ä¸Šã®<b>PDFã‚’ä½œæˆ</b>ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚å°åˆ·ç”»é¢ã§ <b>é€ä¿¡å…ˆ: PDFã«ä¿å­˜</b> ã‚’é¸ã³ã€ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</p>
              <h2>ç‰¹é•·</h2>
              <ul>
                <li>ãƒšãƒ¼ã‚¸ã‚µã‚¤ã‚º/å‘ã/ä½™ç™½ã‚’é¸æŠ</li>
                <li>ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ã¨ãƒšãƒ¼ã‚¸ç•ªå·</li>
                <li>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ç”»åƒæŒ¿å…¥</li>
                <li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯æŒ¿å…¥</li>
              </ul>
              <div class="page-break">â€” ã“ã“ã§ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Š â€”</div>
              <p>ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Šã®ã‚µãƒ³ãƒ—ãƒ«ã€‚å°åˆ·æ™‚ã«ã¯ã“ã®ç°è‰²ãƒãƒ¼ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
(function(){
  const editor = document.getElementById('editor');
  const pageSizeSel = document.getElementById('pageSize');
  const orientSel = document.getElementById('orientation');
  const marginInput = document.getElementById('margin');
  const fontSel = document.getElementById('font');
  const fontSizeInput = document.getElementById('fontSize');
  const lineHeightInput = document.getElementById('lineHeight');
  const printBtn = document.getElementById('printBtn');
  const saveBtn = document.getElementById('save');
  const loadBtn = document.getElementById('load');
  const resetBtn = document.getElementById('reset');

  const useHeader = document.getElementById('useHeader');
  const useFooter = document.getElementById('useFooter');
  const headerText = document.getElementById('headerText');
  const footerText = document.getElementById('footerText');
  const usePageNum = document.getElementById('usePageNum');

  const headerContent = document.getElementById('headerContent');
  const footerContent = document.getElementById('footerContent');
  const pageNum = document.getElementById('pageNum');
  const printBody = document.getElementById('printBody');

  const imgBtn = document.getElementById('imgBtn');
  const imgInput = document.getElementById('imgInput');
  const linkBtn = document.getElementById('linkBtn');
  const pageBreakBtn = document.getElementById('pageBreakBtn');

  const tplButtons = document.querySelectorAll('button[data-tpl]');

  const pageSizeMap = {
    A4: { w:210, h:297 },
    A5: { w:148, h:210 },
    Letter: { w:215.9, h:279.4 }
  };

  function mmToPx(mm){ return mm * 96 / 25.4; }

  function updateScreenPaperWidth(){
    const size = pageSizeMap[pageSizeSel.value];
    const margin = Number(marginInput.value || 15);
    const isLandscape = orientSel.value === 'landscape';
    const pageWmm = isLandscape ? size.h : size.w;
    const contentWmm = Math.max(20, pageWmm - margin * 2);
    const px = Math.round(mmToPx(contentWmm));
    document.querySelector('.print-body').style.maxWidth = px + 'px';
  }

  function ensurePrintStyle(){
    let st = document.getElementById('dynamicPrint');
    if(!st){
      st = document.createElement('style');
      st.id = 'dynamicPrint';
      document.head.appendChild(st);
    }
    return st;
  }

  function updatePrintCSS(){
    const sizeKey = pageSizeSel.value; const size = pageSizeMap[sizeKey];
    const margin = Number(marginInput.value || 15);
    const orientation = orientSel.value;
    const headerOn = useHeader.checked;
    const footerOn = useFooter.checked;

    const headerH = headerOn ? 12 : 0; // mm
    const footerH = footerOn ? 12 : 0; // mm

    headerContent.textContent = headerText.value || '';
    footerContent.textContent = footerText.value || '';

    pageNum.style.display = (footerOn && usePageNum.checked) ? 'inline-block' : 'none';

    const st = ensurePrintStyle();
    st.textContent = `@media print{\n`+
      `  @page{ size:${sizeKey} ${orientation}; margin:${margin}mm; }\n`+
      `  .print-body{ margin-top:${headerH}mm; margin-bottom:${footerH}mm; }\n`+
      `  .print-header{ display:${headerOn ? 'block':'none'}; }\n`+
      `  .print-footer{ display:${footerOn ? 'block':'none'}; }\n`+
      `}`;
  }

  function applyEditorStyles(){
    editor.style.fontFamily = fontSel.value;
    editor.style.fontSize = Number(fontSizeInput.value || 16) + 'px';
    editor.style.lineHeight = Number(lineHeightInput.value || 1.6);
  }

  function exec(cmd, val=null){
    document.execCommand(cmd, false, val);
    editor.focus();
  }

  // Toolbar basic commands
  document.querySelectorAll('.tbtn[data-cmd]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      exec(btn.dataset.cmd);
    });
  });
  // Block format
  document.querySelectorAll('.tbtn[data-block]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const tag = btn.dataset.block;
      exec('formatBlock', tag === 'P' ? 'P' : tag);
    });
  });

  linkBtn.addEventListener('click', ()=>{
    const url = prompt('ãƒªãƒ³ã‚¯URLã‚’å…¥åŠ›:');
    if(url){ exec('createLink', url); }
  });

  pageBreakBtn.addEventListener('click', ()=>{
    const node = document.createElement('div');
    node.className = 'page-break';
    node.textContent = 'â€” ã“ã“ã§ãƒšãƒ¼ã‚¸åŒºåˆ‡ã‚Š â€”';
    insertNodeAtCursor(node);
  });

  imgBtn.addEventListener('click', ()=> imgInput.click());
  imgInput.addEventListener('change', (e)=>{
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const rd = new FileReader();
    rd.onload = ()=> insertImage(rd.result);
    rd.readAsDataURL(f);
    imgInput.value = '';
  });

  function insertImage(src){
    const img = document.createElement('img');
    img.src = src; img.alt = '';
    img.style.maxWidth = '100%';
    img.style.height = 'auto';
    insertNodeAtCursor(img);
  }

  function insertNodeAtCursor(node){
    const sel = window.getSelection();
    if(!sel || sel.rangeCount === 0){ editor.appendChild(node); return; }
    const range = sel.getRangeAt(0);
    range.deleteContents();
    range.insertNode(node);
    range.setStartAfter(node); range.setEndAfter(node);
    sel.removeAllRanges(); sel.addRange(range);
    editor.focus();
  }

  // Drag & Drop images
  editor.addEventListener('dragover', (e)=>{ e.preventDefault(); });
  editor.addEventListener('drop', (e)=>{
    e.preventDefault();
    const files = e.dataTransfer.files;
    if(files && files.length){
      [...files].forEach(f=>{
        if(f.type.startsWith('image/')){
          const rd = new FileReader(); rd.onload = ()=> insertImage(rd.result); rd.readAsDataURL(f);
        }
      });
    }
  });

  // Paste image from clipboard
  editor.addEventListener('paste', (e)=>{
    const items = e.clipboardData && e.clipboardData.items;
    if(!items) return;
    for(const it of items){
      if(it.type && it.type.indexOf('image') !== -1){
        const file = it.getAsFile();
        const rd = new FileReader(); rd.onload = ()=> insertImage(rd.result); rd.readAsDataURL(file);
        e.preventDefault();
      }
    }
  });

  // Persistence
  const STORAGE_KEY = 'easy_pdf_maker_v1';
  function save(){
    const data = {
      html: editor.innerHTML,
      pageSize: pageSizeSel.value,
      orientation: orientSel.value,
      margin: marginInput.value,
      font: fontSel.value,
      fontSize: fontSizeInput.value,
      lineHeight: lineHeightInput.value,
      useHeader: useHeader.checked,
      useFooter: useFooter.checked,
      usePageNum: usePageNum.checked,
      headerText: headerText.value,
      footerText: footerText.value
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    flash('ä¿å­˜ã—ã¾ã—ãŸ');
  }
  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw){ flash('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
    try{
      const d = JSON.parse(raw);
      editor.innerHTML = d.html || editor.innerHTML;
      pageSizeSel.value = d.pageSize || 'A4';
      orientSel.value = d.orientation || 'portrait';
      marginInput.value = d.margin || 15;
      fontSel.value = d.font || fontSel.value;
      fontSizeInput.value = d.fontSize || 16;
      lineHeightInput.value = d.lineHeight || 1.6;
      useHeader.checked = !!d.useHeader;
      useFooter.checked = !!d.useFooter;
      usePageNum.checked = !!d.usePageNum;
      headerText.value = d.headerText || '';
      footerText.value = d.footerText || '';
      applyEditorStyles(); updatePrintCSS(); updateScreenPaperWidth();
      flash('èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
    }catch(err){ console.error(err); flash('èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'); }
  }
  function resetAll(){
    if(!confirm('å†…å®¹ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) return;
    localStorage.removeItem(STORAGE_KEY);
    editor.innerHTML = '<h1>ã‚ˆã†ã“ãï¼ æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼</h1>\n<p>ã“ã“ã«æ–‡ç« ã‚’æ›¸ãâ€¦</p>';
    pageSizeSel.value = 'A4';
    orientSel.value = 'portrait';
    marginInput.value = 15; fontSel.value = "'Noto Sans JP', sans-serif";
    fontSizeInput.value = 16; lineHeightInput.value = 1.6;
    useHeader.checked = true; useFooter.checked = true; usePageNum.checked = true;
    headerText.value = 'æ¥½ã€…ï¼PDFãƒ¡ãƒ¼ã‚«ãƒ¼'; footerText.value = 'Â© 2025 Koppy Lab';
    applyEditorStyles(); updatePrintCSS(); updateScreenPaperWidth();
  }

  saveBtn.addEventListener('click', save);
  loadBtn.addEventListener('click', load);
  resetBtn.addEventListener('click', resetAll);

  [pageSizeSel, orientSel, marginInput, useHeader, useFooter, usePageNum, headerText, footerText]
    .forEach?.(()=>{}) // placeholder (older browsers)

  pageSizeSel.addEventListener('change', ()=>{ updatePrintCSS(); updateScreenPaperWidth(); });
  orientSel.addEventListener('change', ()=>{ updatePrintCSS(); updateScreenPaperWidth(); });
  marginInput.addEventListener('input', ()=>{ updatePrintCSS(); updateScreenPaperWidth(); });
  useHeader.addEventListener('change', updatePrintCSS);
  useFooter.addEventListener('change', updatePrintCSS);
  usePageNum.addEventListener('change', updatePrintCSS);
  headerText.addEventListener('input', updatePrintCSS);
  footerText.addEventListener('input', updatePrintCSS);

  fontSel.addEventListener('change', applyEditorStyles);
  fontSizeInput.addEventListener('input', applyEditorStyles);
  lineHeightInput.addEventListener('input', applyEditorStyles);

  printBtn.addEventListener('click', ()=>{ updatePrintCSS(); window.print(); });

  // Templates
  const templates = {
    simple: `\n<h1>ä»¶åï¼šâ—¯â—¯â—¯ã«é–¢ã™ã‚‹ã”æ¡ˆå†…</h1>\n<p>å¹³ç´ ã‚ˆã‚ŠãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™ã€‚<br>æ ªå¼ä¼šç¤¾â–³â–³ã®â–¡â–¡ã§ã™ã€‚</p>\n<h2>æ¦‚è¦</h2>\n<ul><li>æ—¥æ™‚ï¼š2025å¹´8æœˆ20æ—¥(æ°´) 14:00-15:00</li><li>å ´æ‰€ï¼šã‚ªãƒ³ãƒ©ã‚¤ãƒ³(Zoom)</li><li>ç›®çš„ï¼šæ–°æ©Ÿèƒ½ã®ã”ç´¹ä»‹</li></ul>\n<h2>è©³ç´°</h2>\n<p>å½“æ—¥ã¯ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’äºˆå®šã—ã¦ã„ã¾ã™ã€‚ã”ä¸æ˜ç‚¹ã¯ä¸‹è¨˜ãŠå•ã„åˆã‚ã›å…ˆã¾ã§ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>\n<p>â€”â€”â€”</p>\n<p>æ ªå¼ä¼šç¤¾â–³â–³<br>â–¡â–¡ï¼ˆéƒ¨ç½²åï¼‰<br>TEL: XX-XXXX-XXXX / MAIL: info@example.com</p>`,
    flyer: `\n<h1>ã€å‚åŠ è€…å‹Ÿé›†ã€‘ã€‡ã€‡ ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—</h1>\n<p>å¤§ã¾ã‹ãªèª¬æ˜</p>\n<ul><li>æ—¥ç¨‹ï¼šX/Y(æ—¥) XX:YY-XX:YY</li><li>å ´æ‰€ï¼šXXãƒ¢ãƒ¼ãƒ« 2éšã®ã€‡ã€‡å±‹</li><li>æŒã¡ç‰©ï¼šç„¡ã—</li></ul>\n<h2>ãŠç”³è¾¼ã¿</h2>\n<p>QRã‚³ãƒ¼ãƒ‰ã¾ãŸã¯URLã‹ã‚‰ãŠç”³è¾¼ã¿ãã ã•ã„ã€‚</p>`,
    invoice: `\n<h1>è«‹æ±‚æ›¸</h1>\n<p>è«‹æ±‚æ—¥ï¼š20XX/0X/YYã€€è«‹æ±‚ç•ªå·ï¼šINV-20XX-001</p>\n<table style="width:100%; border-collapse:collapse">
      <thead>
        <tr><th style="border:1px solid #ccc; padding:6px; text-align:left">å“ç›®</th><th style="border:1px solid #ccc; padding:6px; text-align:right">æ•°é‡</th><th style="border:1px solid #ccc; padding:6px; text-align:right">å˜ä¾¡</th><th style="border:1px solid #ccc; padding:6px; text-align:right">é‡‘é¡</th></tr>
      </thead>
      <tbody>
        <tr><td style="border:1px solid #ccc; padding:6px">ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—é‹å–¶è²»</td><td style="border:1px solid #ccc; padding:6px; text-align:right">1</td><td style="border:1px solid #ccc; padding:6px; text-align:right">50,000</td><td style="border:1px solid #ccc; padding:6px; text-align:right">50,000</td></tr>
        <tr><td style="border:1px solid #ccc; padding:6px">æ•™æä½œæˆè²»</td><td style="border:1px solid #ccc; padding:6px; text-align:right">1</td><td style="border:1px solid #ccc; padding:6px; text-align:right">15,000</td><td style="border:1px solid #ccc; padding:6px; text-align:right">15,000</td></tr>
      </tbody>
      <tfoot>
        <tr><td colspan="3" style="border:1px solid #ccc; padding:6px; text-align:right">å°è¨ˆ</td><td style="border:1px solid #ccc; padding:6px; text-align:right">65,000</td></tr>
        <tr><td colspan="3" style="border:1px solid #ccc; padding:6px; text-align:right">æ¶ˆè²»ç¨(10%)</td><td style="border:1px solid #ccc; padding:6px; text-align:right">6,500</td></tr>
        <tr><td colspan="3" style="border:1px solid #ccc; padding:6px; text-align:right"><b>åˆè¨ˆ</b></td><td style="border:1px solid #ccc; padding:6px; text-align:right"><b>71,500</b></td></tr>
      </tfoot>
    </table>\n<p style="margin-top:12px">ãŠæŒ¯è¾¼å…ˆï¼šâ—¯â—¯éŠ€è¡Œ Ã—Ã—æ”¯åº— æ™®é€š 1234567 â—¯â—¯å¡¾</p>`
  };
  tplButtons.forEach(b=>{
    b.addEventListener('click', ()=>{
      const key = b.dataset.tpl;
      insertHtml(templates[key] || '');
    });
  });

  function insertHtml(html){
    const frag = document.createRange().createContextualFragment(html);
    insertNodeAtCursor(frag);
  }

  // Initial apply
  applyEditorStyles(); updatePrintCSS(); updateScreenPaperWidth();

  function flash(msg){
    const tip = document.createElement('div');
    tip.textContent = msg;
    Object.assign(tip.style, {
      position:'fixed', bottom:'24px', left:'50%', transform:'translateX(-50%)',
      background:'rgba(34,211,238,.95)', color:'#05232a', padding:'10px 16px',
      borderRadius:'12px', fontWeight:'700', zIndex:9999, boxShadow:'0 8px 20px rgba(0,0,0,.25)'
    });
    document.body.appendChild(tip);
    setTimeout(()=> tip.remove(), 1500);
  }
})();
</script>

</body>
</html>



